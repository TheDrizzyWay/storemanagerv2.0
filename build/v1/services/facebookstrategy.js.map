{"version":3,"sources":["../../../api/v1/services/facebookstrategy.js"],"names":["User","db","dotenv","config","process","env","FACEBOOK_APP_ID","FACEBOOK_APP_SECRET","facebookSetup","clientID","clientSecret","callbackURL","profileFields","facebookCallback","accessToken","refreshToken","profile","cb","email","emails","value","name","familyName","givenName","console","log","findOrCreate","where","defaults","firstName","lastName","password","id","role","user","dataValues","facebookStrategy","FacebookStrategy"],"mappings":";;;;;;;;;;;;;;AAAA;;AACA;;;;AACA;;;;;;IAEQA,I,GAASC,gB,CAATD,I;;AACRE,iBAAOC,MAAP;;mBAEiDC,QAAQC,G;IAAjDC,e,gBAAAA,e;IAAiBC,mB,gBAAAA,mB;;;AAEzB,IAAMC,gBAAgB;AACpBC,YAAUH,eADU;AAEpBI,gBAAcH,mBAFM;AAGpBI,eAAa,qDAHO;AAIpBC,iBAAe,CAAC,IAAD,EAAO,QAAP,EAAiB,MAAjB,EAAyB,qBAAzB;AAJK,CAAtB;;AAOA,IAAMC;AAAA,sFAAmB,iBAAOC,WAAP,EAAoBC,YAApB,EAAkCC,OAAlC,EAA2CC,EAA3C;AAAA;;AAAA;AAAA;AAAA;AAAA;AACjBC,iBADiB,GACTF,QAAQG,MAAR,CAAe,CAAf,EAAkBC,KADT;AAAA,4BAEWJ,QAAQK,IAFnB,EAEfC,UAFe,iBAEfA,UAFe,EAEHC,SAFG,iBAEHA,SAFG;AAGvB;AACA;;AAEAC,oBAAQC,GAAR,CAAYT,OAAZ;;AANuB;AAAA,mBAQJhB,KAAK0B,YAAL,CAAkB;AACnCC,qBAAO,EAAET,YAAF,EAD4B;AAEnCU,wBAAU;AACRC,2BAAWN,SADH;AAERO,0BAAUR,UAFF;AAGRJ,4BAHQ;AAIRa,0BAAUf,QAAQgB,EAJV;AAKRC,sBAAM;AALE;AAFyB,aAAlB,CARI;;AAAA;AAQjBC,gBARiB;AAAA,6CAkBhBjB,GAAG,IAAH,EAASiB,KAAKC,UAAd,CAlBgB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAnB;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAqBA,IAAMC,mBAAmB,IAAIC,0BAAJ,CAAqB7B,aAArB,EAAoCK,gBAApC,CAAzB;;kBAEeuB,gB","file":"facebookstrategy.js","sourcesContent":["import { Strategy as FacebookStrategy } from 'passport-facebook';\nimport dotenv from 'dotenv';\nimport db from '../models';\n\nconst { User } = db;\ndotenv.config();\n\nconst { FACEBOOK_APP_ID, FACEBOOK_APP_SECRET } = process.env;\n\nconst facebookSetup = {\n  clientID: FACEBOOK_APP_ID,\n  clientSecret: FACEBOOK_APP_SECRET,\n  callbackURL: 'http://localhost:3000/api/v1/auth/facebook/callback',\n  profileFields: ['id', 'emails', 'name', 'picture.type(large)'],\n};\n\nconst facebookCallback = async (accessToken, refreshToken, profile, cb) => {\n  const email = profile.emails[0].value;\n  const { familyName, givenName } = profile.name;\n  // const imageUrl = profile.photos[0].value;\n  // get provider from profile\n\n  console.log(profile);\n\n  const user = await User.findOrCreate({\n    where: { email },\n    defaults: {\n      firstName: givenName,\n      lastName: familyName,\n      email,\n      password: profile.id,\n      role: 'attendant',\n    },\n  });\n  return cb(null, user.dataValues);\n};\n\nconst facebookStrategy = new FacebookStrategy(facebookSetup, facebookCallback);\n\nexport default facebookStrategy;\n"]}